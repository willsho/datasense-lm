(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8435:(e,t,r)=>{Promise.resolve().then(r.bind(r,1014))},1014:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var a=r(5155);let s=(0,r(2081).vt)(e=>({csvData:null,analysisResult:null,isLoading:!1,error:null,setCsvData:t=>e({csvData:t}),setAnalysisResult:t=>e({analysisResult:t}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),reset:()=>e({csvData:null,analysisResult:null,error:null})}));var o=r(2115),l=r(3463),i=r(9795),n=r(9159),d=r.n(n);async function c(e){return new Promise((t,r)=>{d().parse(e,{header:!0,complete:e=>{t({headers:e.meta.fields||[],rows:e.data})},error:e=>r(e)})})}var u=r(1290);let m=o.forwardRef((e,t)=>{let{className:r,asChild:s=!1,variant:o="default",...n}=e,d=s?u.DX:"button";return(0,a.jsx)(d,{className:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.QP)((0,l.$)(t))}("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","default"===o?"bg-primary text-primary-foreground hover:bg-primary/90":"","outline"===o?"border border-input bg-background hover:bg-accent hover:text-accent-foreground":"","h-10 px-4 py-2",r),ref:t,...n})});m.displayName="Button";var p=r(5067);function h(){let[e,t]=(0,o.useState)(!1),{setLoading:r,setCsvData:l,setError:i}=s(),n=o.useRef(null),d=(0,o.useCallback)(async e=>{if(!e.name.endsWith(".csv")){i("请上传 CSV 文件");return}try{r(!0),i(null);let t=await c(e);l(t)}catch(e){i("文件解析失败，请确保文件格式正确"),console.error("CSV parsing error:",e)}finally{r(!1)}},[l,i,r]),u=(0,o.useCallback)(e=>{e.preventDefault(),t(!1);let r=e.dataTransfer.files[0];r&&d(r)},[d]),h=(0,o.useCallback)(e=>{e.preventDefault(),t(!0)},[]),y=(0,o.useCallback)(e=>{e.preventDefault(),t(!1)},[]),g=(0,o.useCallback)(()=>{var e;null===(e=n.current)||void 0===e||e.click()},[]),b=(0,o.useCallback)(e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&d(r)},[d]);return(0,a.jsxs)("div",{className:"relative border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n        ".concat(e?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDrop:u,onDragOver:h,onDragLeave:y,onClick:g,children:[(0,a.jsx)("input",{type:"file",ref:n,className:"hidden",accept:".csv",onChange:b}),(0,a.jsx)(p.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)(m,{type:"button",variant:"outline",className:"mx-auto",children:"选择 CSV 文件"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"或将文件拖放到此处"})]})]})}var y=r(3403),g=r(1077);r(6419);let b={custom:function(e){let{data:t,width:r=240,height:s=100}=e;return(0,a.jsxs)("div",{className:"px-4 py-3 rounded-md shadow-md border ".concat(t.color||"bg-white"),style:{width:"".concat(r,"px"),height:"".concat(s,"px"),display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,a.jsx)(g.h7,{type:"source",position:y.yX.Top,id:"top-source",className:"w-2 h-2 !bg-gray-500",style:{left:"25%"}}),(0,a.jsx)(g.h7,{type:"target",position:y.yX.Top,id:"top-target",className:"w-2 h-2 !bg-gray-500",style:{left:"75%"}}),(0,a.jsx)(g.h7,{type:"source",position:y.yX.Left,id:"left-source",className:"w-2 h-2 !bg-gray-500",style:{top:"25%"}}),(0,a.jsx)(g.h7,{type:"target",position:y.yX.Left,id:"left-target",className:"w-2 h-2 !bg-gray-500",style:{top:"75%"}}),(0,a.jsxs)("div",{className:"text-center flex-1 flex flex-col justify-center ".concat(t.textColor||"text-gray-800"),children:[(0,a.jsx)("div",{className:"font-medium",children:t.label}),t.description&&(0,a.jsx)("div",{className:"text-sm opacity-75 mt-1",children:t.description}),t.value&&(0,a.jsx)("div",{className:"mt-2 text-lg font-bold",children:t.value})]}),(0,a.jsx)(g.h7,{type:"source",position:y.yX.Right,id:"right-source",className:"w-2 h-2 !bg-gray-500",style:{top:"25%"}}),(0,a.jsx)(g.h7,{type:"target",position:y.yX.Right,id:"right-target",className:"w-2 h-2 !bg-gray-500",style:{top:"75%"}}),(0,a.jsx)(g.h7,{type:"source",position:y.yX.Bottom,id:"bottom-source",className:"w-2 h-2 !bg-gray-500",style:{left:"25%"}}),(0,a.jsx)(g.h7,{type:"target",position:y.yX.Bottom,id:"bottom-target",className:"w-2 h-2 !bg-gray-500",style:{left:"75%"}})]})}},x={custom:function(e){let{id:t,sourceX:r,sourceY:s,targetX:o,targetY:l,sourcePosition:i,targetPosition:n,style:d={},markerEnd:c,label:u,labelStyle:m,labelBgStyle:p}=e,[h,b,x]=(0,y.Fp)({sourceX:r,sourceY:s,sourcePosition:i,targetX:o,targetY:l,targetPosition:n});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.tE,{id:t,path:h,markerEnd:c,style:d,labelStyle:m,labelBgStyle:p}),u&&(0,a.jsxs)("text",{x:b,y:x,className:"fill-gray-700 text-[12px] font-medium",textAnchor:"middle",dominantBaseline:"middle",style:{...m,fontSize:"12px"},children:[(0,a.jsx)("tspan",{x:b,dy:"-0.5em",children:u}),(0,a.jsx)("rect",{x:b-40,y:x-10,width:"80",height:"20",className:"fill-white opacity-75",style:p})]})]})}};function f(e){let{data:t}=e,r=(0,o.useCallback)(e=>{let r=t.rows.find(t=>String(t.metric_name).toLowerCase()===e.toLowerCase());return(null==r?void 0:r.metric_value)||0},[t]),s=(0,o.useMemo)(()=>[{id:"reactivated",type:"custom",position:{x:50,y:20},width:200,height:120,data:{label:"重新激活用户",description:"(首次回访)",value:r("reactivated_user"),color:"bg-green-100"}},{id:"new",type:"custom",position:{x:400,y:20},width:200,height:120,data:{label:"新用户",description:"(首次使用应用)",value:r("new_user"),color:"bg-green-100"}},{id:"resurrected",type:"custom",position:{x:750,y:20},width:200,height:120,data:{label:"复活用户",description:"(首日回访)",value:r("resurrected_user"),color:"bg-green-100"}},{id:"current",type:"custom",position:{x:420,y:210},width:280,height:140,data:{label:"当前用户",description:"(今日活跃且过去7天内至少活跃1次)",value:r("current_user"),color:"bg-blue-100"}},{id:"at-risk-wau",type:"custom",position:{x:100,y:400},width:280,height:100,data:{label:"周活跃用户流失风险",description:"(今日不活跃，但过去1-6天活跃)",value:r("at_risk_waus"),color:"bg-orange-100"}},{id:"at-risk-mau",type:"custom",position:{x:100,y:580},width:450,height:100,data:{label:"月活跃用户流失风险",description:"(今日不活跃，过去1-6天不活跃，但过去7-29天活跃)",value:r("at_risk_maus"),color:"bg-pink-100"}},{id:"dead",type:"custom",position:{x:100,y:750},width:600,height:100,data:{label:"流失用户",description:"(今日及过去29天不活跃)",value:r("dead_users"),color:"bg-red-100"}}],[r]),l=(0,o.useMemo)(()=>{let e=Number(r("RURR")),t=Number(r("SURR")),a=Number(r("CURR")),s=Number(r("NURR")),o=Number(r("iMAURR"));return[{id:"e1-rurr",source:"reactivated",target:"current",animated:!0,type:"smoothstep",label:"RURR: ".concat(e.toFixed(2),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#60a5fa",strokeWidth:3},sourceHandle:"right-source",targetHandle:"left-target",labelStyle:{fontSize:14}},{id:"e1-1rurr",source:"reactivated",target:"at-risk-wau",animated:!0,type:"smoothstep",label:"1-RURR: ".concat((100-e).toFixed(2),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#f97316",strokeWidth:3},sourceHandle:"right-source",targetHandle:"left-target",labelStyle:{fontSize:14}},{id:"e2-nurr",source:"new",target:"current",animated:!0,type:"smoothstep",label:"NURR: ".concat(s.toFixed(2),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#60a5fa",strokeWidth:3},sourceHandle:"bottom-source",targetHandle:"top-target",labelStyle:{fontSize:14}},{id:"e2-1nurr",source:"new",target:"at-risk-wau",animated:!0,type:"smoothstep",label:"1-NURR: ".concat((100-s).toFixed(2),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#f97316",strokeWidth:3},sourceHandle:"bottom-source",targetHandle:"top-target",labelStyle:{fontSize:14}},{id:"e3-surr",source:"resurrected",target:"current",animated:!0,type:"smoothstep",label:"SURR: ".concat(t.toFixed(2),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#60a5fa",strokeWidth:3},sourceHandle:"left-source",targetHandle:"top-target",labelStyle:{fontSize:14}},{id:"e3-1surr",source:"resurrected",target:"at-risk-wau",animated:!0,type:"smoothstep",label:"1-SURR: ".concat((100-t).toFixed(2),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#f97316",strokeWidth:3},sourceHandle:"bottom-source",targetHandle:"right-target",labelStyle:{fontSize:14}},{id:"e4-curr",source:"current",target:"current",animated:!0,type:"smoothstep",label:"CURR:\n".concat(a.toFixed(2),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#60a5fa",strokeWidth:3},sourceHandle:"right-source",targetHandle:"bottom-target",labelStyle:{fontSize:14}},{id:"e4-1curr",source:"current",target:"at-risk-wau",animated:!0,type:"smoothstep",label:"1-CURR: ".concat((100-a).toFixed(2),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#f97316",strokeWidth:3},sourceHandle:"bottom-source",targetHandle:"top-target",labelStyle:{fontSize:14}},{id:"e5-iwaurr",source:"at-risk-wau",target:"current",animated:!0,type:"smoothstep",label:"iWAURR: ".concat(r("iWAURR"),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#60a5fa",strokeWidth:3},sourceHandle:"top-source",targetHandle:"left-target",labelStyle:{fontSize:14}},{id:"e5-wau-loss",source:"at-risk-wau",target:"at-risk-mau",animated:!0,type:"smoothstep",label:"WAU流失率: ".concat(r("WAU流失率"),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#ec4899",strokeWidth:3},sourceHandle:"bottom-source",targetHandle:"top-target",labelStyle:{fontSize:14}},{id:"e6-mau-loss",source:"at-risk-mau",target:"dead",animated:!0,type:"smoothstep",label:"MAU流失率: ".concat(r("MAU流失率"),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#ef4444",strokeWidth:3},sourceHandle:"bottom-source",targetHandle:"top-target",labelStyle:{fontSize:14}},{id:"e6-imaurr",source:"at-risk-mau",target:"reactivated",animated:!0,type:"smoothstep",label:"iMAURR: ".concat(o.toFixed(2),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#22c55e",strokeWidth:3},sourceHandle:"left-source",targetHandle:"left-target",labelStyle:{fontSize:14}},{id:"e7-resurrection",source:"dead",target:"resurrected",type:"smoothstep",animated:!0,label:"复活率: ".concat(r("复活率"),"%"),markerEnd:{type:y.TG.ArrowClosed},style:{stroke:"#22c55e",strokeWidth:3},sourceHandle:"right-source",targetHandle:"right-target",labelStyle:{fontSize:14}}]},[r]);return(0,a.jsx)("div",{className:"w-full h-[800px]",children:(0,a.jsxs)(g.Gc,{nodes:s,edges:l,nodeTypes:b,edgeTypes:x,fitView:!0,className:"bg-white rounded-lg shadow-xl",children:[(0,a.jsx)(g.VS,{}),(0,a.jsx)(g.H2,{})]})})}function k(){let{isLoading:e,error:t,csvData:r}=s();return(0,a.jsxs)("div",{className:"w-full max-w-5xl mx-auto",children:[t&&(0,a.jsx)("div",{className:"mb-4 p-4 text-red-700 bg-red-100 rounded-md",children:t}),e?(0,a.jsxs)("div",{className:"text-center p-8",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"正在解析文件..."})]}):r?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center p-4 bg-green-100 text-green-700 rounded-md",children:[(0,a.jsx)("p",{children:"文件上传成功！"}),(0,a.jsxs)("p",{className:"text-sm mt-1",children:["共 ",r.headers.length," 列，",r.rows.length," 行数据"]})]}),(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center mb-4",children:"用户活跃度分析"}),(0,a.jsx)(f,{data:r})]})]}):(0,a.jsx)(h,{})]})}function v(){return(0,a.jsx)("main",{className:"min-h-screen p-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-center mb-2",children:"DataSenseLM"}),(0,a.jsx)("p",{className:"text-center text-gray-600 mb-8",children:"用户活跃度分析可视化工具"}),(0,a.jsx)("div",{className:"bg-white/30 p-8 rounded-lg backdrop-blur-sm",children:(0,a.jsx)(k,{})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[946,862,407,441,517,358],()=>t(8435)),_N_E=e.O()}]);